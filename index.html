<!DOCTYPE html>
<html>
<head>
    <title>Daraz - Customer Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="bg-[#f85606] p-4 text-white flex justify-between items-center shadow-md">
        <h1 class="text-2xl font-bold italic">daraz</h1>
        <div id="status" class="text-[10px] bg-black/20 px-2 py-1 rounded">Connecting...</div>
    </div>

    <div class="max-w-md mx-auto p-4 bg-white mt-5 shadow rounded-lg flex gap-4">
        <img src="https://via.placeholder.com/100" class="w-20 h-20 rounded">
        <div>
            <h2 class="text-sm font-bold">Premium Earbuds</h2>
            <p class="text-orange-600 font-bold text-sm">à§³ 1,500</p>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 bg-white shadow-xl border rounded-lg">
        <div id="chat-window" class="h-80 overflow-y-auto p-4 flex flex-col gap-2 bg-gray-50">
            <p class="text-gray-400 text-center italic text-xs mt-20">Waiting for Admin to connect...</p>
        </div>

        <div class="p-3 border-t bg-white">
            <div class="flex gap-1">
                <input id="input-msg" type="text" placeholder="Message lekho..." class="flex-1 border p-2 text-sm rounded outline-none" disabled>
                <button id="send-btn" onclick="sendMsg()" class="bg-gray-400 text-white px-4 rounded font-bold opacity-50" disabled>Send</button>
            </div>
        </div>
    </div>

    <script>
        const ably = new Ably.Realtime('8O7Y_w.7VvC-w:9S5_W6U9U0N0T1S2');
        const channel = ably.channels.get('chat-room');

        channel.subscribe('approval', (msg) => {
            if(msg.data === "APPROVED") {
                document.getElementById('status').innerText = "Admin Online";
                document.getElementById('status').classList.replace("bg-black/20", "bg-green-500");
                document.getElementById('input-msg').disabled = false;
                document.getElementById('send-btn').disabled = false;
                document.getElementById('send-btn').classList.replace("bg-gray-400", "bg-[#f85606]");
                document.getElementById('send-btn').classList.remove("opacity-50");
                document.getElementById('chat-window').innerHTML = "";
            }
        });

        channel.subscribe('chat', (msg) => {
            const chatWindow = document.getElementById('chat-window');
            const isMe = msg.data.sender === "Bondhu";
            chatWindow.innerHTML += `<div class="p-2 rounded-lg max-w-[80%] ${isMe ? 'bg-orange-100 self-end' : 'bg-gray-200 self-start text-gray-800'}"><b>${msg.data.sender}:</b> ${msg.data.text}</div>`;
            chatWindow.scrollTop = chatWindow.scrollHeight;
        });

        function sendMsg() {
            const input = document.getElementById('input-msg');
            if(input.value) {
                channel.publish('chat', { sender: "Bondhu", text: input.value });
                input.value = "";
            }
        }
    </script>
</body>
</html>
